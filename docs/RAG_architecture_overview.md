# RAG系统架构概览

## 1. 引言

本智能问答系统是一个基于检索增强生成（Retrieval-Augmented Generation, RAG）架构的先进实现。它旨在通过结合外部知识库来克服大型语言模型（LLM）的知识局限性和“幻觉”问题，从而在专业领域（如医疗）提供准确、可靠且可追溯的答案。

本文档旨在提供一个关于本系统RAG架构的高层次概览，并作为导航，链接到每个核心组件的详细技术解析。

## 2. 整体架构

整个系统的工作流程可以分为两个主要阶段：

1.  **离线阶段：知识入库（Data Ingestion）**：将原始文档（如PDF）处理、切分、向量化，并存入知识库的过程。
2.  **在线阶段：查询处理（Query Processing）**：当用户提出问题时，系统实时地进行检索、重排、生成答案的完整链条。

![RAG Architecture Diagram](https://example.com/rag_architecture.png)  <!-- 你可以替换成一个真实的架构图URL -->

## 3. 核心组件详解

以下是构成我们先进RAG链条的核心组件。每个组件都经过精心设计和优化，以实现最佳性能。点击链接可跳转到对应组件的深度解析文档。

### 3.1. [智能文档处理](./rag_components/1_document_processing.md)

- **概述**：此阶段是构建高质量知识库的基础。它负责将原始、非结构化的PDF文档，转化为干净、结构化、且充满丰富元数据的信息块。
- **核心组件**：
    - `EnhancedPDFProcessor`：不仅提取文本，还能解析表格、图片，并理解文档的版面布局。
    - `MedicalTextSplitter`：一个双模调度器，优先使用`HybridTextSplitter`进行智能语义分块，并保留了稳定可靠的传统“递归”分块作为后备。
- **[>> 阅读文档处理的详细实现...](./rag_components/1_document_processing.md)**

### 3.2. [查询转换与优化](./rag_components/2_query_transformation.md)

- **概述**：为了弥合用户口语化查询与知识库专业术语之间的鸿沟，系统在检索前会对查询进行智能优化。
- **核心组件**：
    - `QueryTransformer`：利用LLM对原始查询进行重写和扩展，生成一组更适合检索的“超级查询”，旨在最大化召回率。
- **[>> 阅读查询转换的详细实现...](./rag_components/2_query_transformation.md)**

### 3.3. [四路召回与融合检索](./rag_components/3_retrieval.md)

- **概述**：这是RAG系统的核心引擎。系统采用基于“内容多维度表征”的四路召回策略，并行搜索文档的四种不同“画像”（向量、全文、摘要、关键词），以实现无与伦比的召回率和精确率。
- **核心组件**：
    - `AdvancedFusionRetriever`：一个高度可配置的融合检索器。
    - **四路召回**：并行执行`VECTOR`（向量语义）、`CONTENT`（全文关键词）、`SUMMARY`（摘要关键词）和`KEYWORDS`（关键词列表）四路检索。
    - **结果融合**：使用倒数排名融合（RRF）算法，智能地合并来自所有四路召回路径的结果。
- **[>> 阅读四路召回与融合检索的详细实现...](./rag_components/3_retrieval.md)**

### 3.4. [AI增强重排序](./rag_components/4_reranking.md)

- **概述**：在初步检索后，一个更强大的“裁判”模型会对候选文档进行二次“精读”，以确保只有最相关、最优质的信息被送入最后的生成环节。
- **核心组件**：
    - `EnhancedReranker`：调用外部大模型API（如通义千问），对候选文档进行深度相关性打分和排序，实现优中选优。
    - **智能缓存**：缓存重排序结果，大幅提升重复查询的效率和响应速度。
- **[>> 阅读重排序的详细实现...](./rag_components/4_reranking.md)**

### 3.5. [上下文构建与答案生成](./rag_components/5_response_generation.md)

- **概述**：RAG链条的最后一公里。系统将筛选出的精华信息构建成上下文，通过精心设计的Prompt，引导LLM生成专业、安全、可信的答案。
- **核心组件**：
    - `EnhancedRAGWorkflow`：负责编排整个生成流程。
    - **Prompt工程**：针对医疗领域的专业Prompt模板，包含角色设定、核心指令和安全约束。
    - **流式生成与答案溯源**：实现打字机效果的流式响应，并在前端清晰地展示答案的文献来源。
- **[>> 阅读答案生成的详细实现...](./rag_components/5_response_generation.md)**

## 4. 总结

本RAG系统是一个由多个高度优化、协同工作的组件构成的精密工程。通过在文档处理、查询优化、融合检索、AI重排和答案生成等每一个环节的精雕细琢，我们得以构建一个在专业领域表现出色、答案精准可信的智能问答系统。希望本系列文档能帮助您全面理解其内部工作原理。
